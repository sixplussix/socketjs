{"version":3,"file":"socket.mjs","sources":["../lib/utils.js","../lib/webjs.js","../lib/transport.js","../lib/trans_websocket.js","../lib/trans_jsonp.js","../lib/trans_xhr.js","../lib/iframe.js","../lib/trans_eventsource.js","../lib/trans_htmlfile.js","../lib/chunking-test.js","../lib/index.js"],"sourcesContent":["/**\n * Adds two numbers together, returning the sum.\n */\nimport * as crypto from 'crypto';\nexport function array_intersection (arr_a, arr_b) {\n  let r = []\n  arr_a.forEach((a) => {\n    if (arr_b.indexOf(a) !== -1) {\n      r.push(a)\n    }\n  })\n  return r\n}\n\nexport function escape_selected (str, chars) {\n  let map = {}\n  chars = '%' + chars\n  for ( let len = chars.length; len -- > 0;) {\n    map[chars[len]] = escape(chars[len])\n  }\n  let r = new RegExp('([' + chars +'])')\n  let parts = str.split(r)\n  for (let i = 0, len = parts.length; i < len; i ++) {\n    let v = parts[i]\n    if (v.length === 1 && v in map) {\n      parts[i] = map[v]\n    }\n  }\n  return parts.join('')\n}\n\nexport function buffer_concat (buf_a, buf_b) {\n  let dst = new Buffer(buf_a.length, buf_b.length)\n  buf_a.copy(dst);\n  buf_b.copy(dst, buf_a.length)\n  return dst;\n}\n\nexport function md5_hex (data) {\n  return crypto.createHash('md5')\n          .update(data)\n          .digest('hex')\n}\n\nexport function sha1_base64 (data) {\n  return crypto.createHash('sha1')\n          .update(data)\n          .digest('base64')\n}\n\nexport function timeout_chain (arr) {\n  arr = arr.slice(0)\n  if (!arr.length) return;\n  let [timeout, user_fun] = arr.shift()\n  let fun = () => {\n    user_fun()\n    timeout_chain(arr)\n  }\n  setTimeout(fun, timeout)\n} \n\nexport function objectExtend (dst, src) {\n  for (let k in src) {\n    if (src.hasOwnProperty(k)) {\n      dst[k] = src[k]\n    }\n  }\n  return dst;\n}\n\n// listeners() returns a reference to the internal array of EventEmitter.\n// Make a copy, because we're about the replace the actual listeners.\nexport function overshadowListeners (ee, event, handler) {\n  let old_listeners = ee.listeners(event).slice(0)\n\n  ee.removeAllListeners(event)\n  let new_handler = function(){\n    if (!handler.apply(this, arguments)) {\n      old_listeners.forEach((listener) => listener.apply(this, arguments))\n      return false\n    }\n    return true\n  }\n  ee.addListener(event, new_handler)\n}\n\nconst ESCAPABLE = /[\\x00-\\x1f\\ud800-\\udfff\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufff0-\\uffff]/g\n\nfunction unroll_lookup (escapable) {\n  let unrolled = {}\n  let c = []\n  for (let i = 0; i < 65536; i ++) {\n    c.push(String.fromCharCode(i))\n  }\n  escapable.lastIndex = 0\n  c.join('').replace(escapable, (a) => {\n    unrolled[a] = '\\\\u' + ('0000' + a.charCodeAt(0).toString(16)).slice(-4)\n  })\n  return unrolled\n}\nconst lookup = unroll_lookup(ESCAPABLE)\n\nexport function quote (string) {\n  let quoted = JSON.stringify(string)\n  ESCAPABLE.lastIndex = 0\n  if (!ESCAPABLE.test(quoted)) {\n    return quoted\n  }\n  return quoted.replace(ESCAPABLE, (a) => lookup[a])\n}\n\nexport function parseCookie (cookie_header) {\n  let cookies = {}\n  if (cookie_header) {\n    cookie_header.split(';').forEach((cookie) => {\n      let parts = cookie.split('=')\n      cookies[parts[0].trim()] = (parts[1] || '').trim()\n    })\n  }\n  return cookies\n}\nexport function random32 () {\n  let randArr = crypto.randomBytes(4)\n  return randArr[0] + randArr[1] * 256 + randArr[2] * 256 * 256 + randArr[3] * 256 * 256 * 256\n}\n","import * as url from 'url'\nimport * as querystring from 'querystring'\nimport * as fs from 'fs'\nimport * as http from 'http'\n\nimport * as utils from './utils'\n\nfunction execute_request (app, funs, req, res, data) {\n  try {\n    while (funs.length > 0) {\n      let fun = funs.shift()\n      req.last_fun = fun\n      data = app[fun](req, res, data, req.next_filter)\n    }\n  } catch (x) {\n    if (typeof x === 'object' && 'status' in x) {\n      if (x.status === 0) {\n        return\n      } else if ('handle_' + x.status in app) {\n        app['handle_' + x.status](req, res, x)\n      } else {\n        app['handle_error'] (req, res, x)\n      }\n    } else {\n      app['handle_error'](req, res, x)\n    }\n    app['log_request'][req, res, true]\n  }\n}\n\nfunction fake_response (req, res) {\n  let headers = {'Connection': 'close'}\n  res.writeHead = function (status, user_headers = {}) {\n    let r = []\n    r.push('HTTP/' + req.httpVersion + ' ' + status + ' ' + http.STATUS_CODES[status])\n    utils.objectExtend(headers, user_headers)\n    Object.keys(headers).forEach((k) => {\n      r.push(k + ': ' + headers[k])\n    })\n    // add tow blank\n    r = r.concat(['', ''])\n    \n    try {\n      res.write(r.join('\\r\\n'))\n    } catch (_) {}\n    try {\n      res.end()\n    } catch (_) {}\n  }\n  res.setHeader = (k, v) => headers[k] = v\n}\n\nexport function generateHandler (app, dispatcher) {\n  return (req, res, head) => {\n    if (typeof res.writeHead  === 'undefined') {\n      fake_response(req, res)\n    }\n    utils.objectExtend(req, url.parse(req.url, true))\n    req.start_date = new Date()\n\n    let found = false\n    let allowed_methods = []\n\n    for(var _i =0, _len = dispatcher.length; _i < _len; _i ++){\n      let row = dispatcher[_i]\n      let [method, path, funs] = row\n      if (path.constructor !== Array) {\n        path = [path]\n      }\n\n      let m = req.pathname.match(path[0])\n      if (!m) {\n        continue\n      }\n      if (!req.method.match(new RegExp(method))) {\n        allowed_methods.push(method)\n        continue\n      }\n      path.forEach((pt, i) => req[pt] = m[i])\n\n      funs = funs.slice(0)\n      funs.push('log_request')\n      req.next_filter = (data) => {\n        execute_request(app, funs, req, res, data)\n      }\n      req.next_filter(head)\n      found = true\n      break\n    }\n\n    if (!found) {\n      if (allowed_methods.length !== 0) {\n        app['handle_405'](req, res, allowed_methods)\n      } else {\n        app['handle_404'](req, res)\n      }\n      app['log_request'](req, res, true)\n    }\n    return\n  }\n}\n\nexport class GenericApp {\n  handle_404 (req, res, x) {\n    if (res.finished) {\n      return x\n    }\n    res.writeHead(404, {})\n    res.end()\n    return true\n  }\n\n  handle_405 (req, res, methods) {\n    res.writeHead(405, {Allow: methods.join(', ')})\n    res.end()\n    return true\n  }\n\n  handle_error (req, res, x) {\n    if (res.finished) {\n      return x\n    } \n    if (typeof x === 'object' && 'status' in x) {\n      res.writeHead(x.status, {})\n      res.end(x.message || '')\n    } else {\n      try {\n        res.writeHead(500, {})\n        res.end('500 - Internal Server Error')\n      } catch (x) {}\n      this.log('error', 'Exception on \"'+ req.method + ' ' + req.href + '\" in filter \"' + req.last_fun + '\":\\n' + (x.stack || x))\n    }\n  }\n\n  log_request (req, res, data) {\n    let td = (new Date()) - req.start_date\n    this.log('info', req.method + ' ' + req.url + ' ' + td + 'ms ' + (res.finished ? res.statusCode : '(unfinished)'))\n  }\n\n  log (severity, line) {\n    console.log(line)\n  }\n\n  expose_html (req, res, content) {\n    if (res.finished) {\n      return content\n    }\n    if (!res.getHeader('Content-Type')) {\n      res.setHeader('Content-Type', 'text/html; charset=UTF-8')\n    }\n    return this.expose(req, res, content)\n  }\n\n  expose_json (req, res, content) {\n    if (res.finished) {\n      return content\n    }\n    if (!res.getHeader('Content-Type')) {\n      res.setHeader('Content-Type', 'application/json')\n    }\n    return this.expose(req, res, JSON.stringify(content))\n  }\n\n  expose (req, res, content) {\n    if (res.finished) {\n      return content\n    }\n    if (content && !res.getHeader('Content-Type')) {\n      res.setHeader('Content-Type', 'text/plain')\n    }\n    if (content) {\n      res.setHeader('Content-Length', content.length)\n    }\n\n    res.writeHead(res.statusCode)\n    res.end(content, 'utf8')\n    return true\n  }\n  serve_file (req, res, filename, next_filter) {\n    let o = (error, content) => {\n      if (error) {\n        res.writeHead(500)\n        res.end(\"can't red file\")\n      } else {\n        res.setHeader('Content-length', content.length)\n        res.writeHead(res.statusCode, res.headers)\n        res.end(content, 'utf8')\n      }\n      next_filter(true)\n    }\n\n    fs.readFile(filename, o)\n    throw {status: 0}\n  }\n\n  cache_for (req, res, content) {\n    res.cahce_for = res.cache_for || 365 * 24 * 60 * 60\n    res.setHeader('Cache-Control', 'public, max-age=' + res.cache_for)\n    let exp = new Date()\n    exp.setTime(exp.getTime() + res.cache_for * 1000)\n    res.setHeader('Expires', exp.toUTCString())\n    return content;\n  }\n\n  h_no_cache (req, res, content) {\n    res.setHeader('Cache-Control', 'no-store, no-cache, no-transform, must-revalidate, max-age=0')\n    return content\n  }\n\n  expect_form (req, res, _data, next_fitler) {\n    let data = new Buffer(0)\n    let q\n    req.on('data', (d) => {\n      data = utils.buffer_concat(data, new Buffer(d, 'binary'))\n    })\n    req.on('end', () => {\n      data = data.toString('utf-8')\n      switch ((req.headers['content-type'] || '').split(';')[0]) {\n        case 'application/x-www-form-urlencoded':\n          q = querystring.parse(data)\n          break\n        case 'text/plain':\n          q = data\n          break\n        default:\n          this.log('error', 'Unsupport content-type ' + req.headers['content-type'])\n          q = undefined\n          break\n      }\n      next_fitler(q)\n    })\n    throw {status: 0}\n  }\n\n  expect_xhr (req, res, _data, next_fitler) {\n    let data = new Buffer(0)\n    let q\n    req.on('data', (d) => {\n      data = utils.buffer_concat(data, new Buffer(d, 'binary'))\n    })\n\n    req.on('end', () => {\n      data = data.toString('utf-8')\n      switch ((req.headers['content-type'] || '').split(';')[0]) {\n        case 'text/plain':\n        case 'T':\n        case 'application/json':\n        case 'application/xml':\n        case '':\n        case 'text/xml':\n          q = data\n          break\n        default:\n          this.log('error', 'Unsupport content-type ' + req.headers['content-type'])\n          q = undefined\n          break\n      }\n      next_fitler(q)\n    })\n    throw {status: 0}\n  }\n}\n","import * as stream from 'stream'\nimport * as uuid   from 'uuid'\nimport * as utils from './utils'\n\nexport class Transport {}\nTransport.CONNECTING = 0\nTransport.OPEN       = 1\nTransport.CLOSING    = 2\nTransport.CLOSED     = 3\n\nconst closeFrame = (status, reason) => {\n  return 'c' + JSON.stringify([status, reason])\n}\n\nexport class SockJSConnection extends stream.Stream {\n  constructor (_session) {\n    super()\n    this._session = _session\n    this.id = uuid.v4()\n    this.headers = {}\n    this.prefix = this._session.prefix\n  }\n\n  toString () {\n    return '<SockJSConnection ' + this.id + '>'\n  }\n\n  write (string) {\n    return this._session.send('' + string)\n  }\n\n  end (string) {\n    if (string) {\n      this.write(string)\n    }\n    this.close()\n    return null\n  }\n\n  close (code, reason) {\n    this._session.close(code, reason)\n  }\n\n  destroy () {\n    this.end()\n    this.removeAllListeners()\n  }\n\n  destroySoon () {\n    this.destroy()\n  }\n}\n\n// utils.objectExtend(SockJSConnection.prototype, stream.Stream.prototype)\nSockJSConnection.prototype.__defineGetter__('readable', function(){this._session.readyState === Transport.OPEN})\nSockJSConnection.prototype.__defineGetter__('writable', function(){this._session.readyState === Transport.OPEN})\nSockJSConnection.prototype.__defineGetter__('readyState', function(){this._session.readyState})\n\nlet MAP = {}\n\nexport class Session {\n  constructor (session_id, server) {\n    this.session_id = session_id\n    this.heartbeat_delay = server.options.heartbeat_delay\n    this.disconnect_delay = server.options.disconnect_delay\n    this.prefix = server.options.prefix\n    this.send_buffer = []\n    this.is_closing = false\n    this.readyState = Transport.CONNECTING\n    if (this.session_id) {\n      MAP[this.session_id] = this\n    }\n    this.timeout_cb = () => this.didTimeout()\n    this.to_tref = setTimeout(this.timeout_cb, this.disconnect_delay)\n    this.connection = new SockJSConnection(this)\n    this.emit_open = () => {\n      this.emit_open = null\n      console.log('emit open')\n      server.emit('connection', this.connection)\n    }\n  }\n\n  register (req, recv) {\n    if (this.recv) {\n      recv.doSendFrame(closeFrame(2010, 'Another connection still open'))\n      recv.didClose()\n      return\n    }\n\n    if (this.to_tref) {\n      clearTimeout(this.to_tref)\n      this.to_tref = null\n    }\n\n    if (this.readyState === Transport.CLOSING) {\n      this.flushToRecv(recv)\n      recv.doSendFrame(this.close_frame)\n      recv.didClose()\n      this.to_tref = setTimeout(this.timeout_cb, this.disconnect_delay)\n      return\n    }\n  \n    this.recv = recv\n    this.recv.session = this\n\n    // Save parameters from request\n\n    this.decorateConnection(req)\n\n    if (this.readyState === Transport.CONNECTING) {\n      this.recv.doSendFrame('o')\n      this.readyState = Transport.OPEN\n      // emit the open event, but not right now\n      process.nextTick(this.emit_open)\n    }\n\n    if (!this.recv) {\n      return\n    }\n    this.tryFlush()\n    return\n  }\n\n  decorateConnection (req) {\n    let socket = this.recv.connection\n    let remoteAddress, remotePort, address\n    if (!socket) {\n      socket = this.recv.response.connection\n    }\n\n    try {\n      remoteAddress = socket.remoteAddress\n      remotePort    = socket.remotePort\n      address       = socket.address\n    } catch (x) { x }\n\n    if (remoteAddress) {\n      this.connection.remoteAddress = remoteAddress\n      this.connection.remotePort = remotePort\n      this.connection.address = address\n    }\n\n    this.connection.url = req.url\n    this.connection.pathname = req.pathname\n    this.protocol = this.recv.protocol\n    \n    let headers = {}\n    let keys = ['referer', 'x-client-ip', 'x-forwarded-for', \n      'x-cluster-client-ip', 'via', 'x-real-ip',\n      'x-forwarded-proto', 'x-ssl',\n      'host', 'user-agent', 'accept-language'\n    ]\n    keys.forEach((k) => {\n      if (req.headers[k]) {\n        headers[k] = req.headers[k]\n      }\n    })\n\n    this.connection.headers = headers\n  }\n\n  unregister () {\n    let delay = this.recv.delay_disconnec\n    this.recv.session = null\n    this.recv = null\n    if (this.to_tref) {\n      clearTimeout(this.to_tref)\n    }\n\n    if (delay) {\n      this.to_tref = setTimeout(this.timeout_cb, this.disconnect_delay)\n    } else {\n      this.timeout_cb()\n    }\n  }\n\n  flushToRecv (recv) {\n    if (this.send_buffer.length > 0) {\n      let sb\n      [sb, this.send_buffer] = [this.send_buffer, []]\n      recv.doSendBulk(sb)\n      return true\n    }\n    return false\n  }\n\n  tryFlush () {\n    if (!this.flushToRecv(this.recv) || !this.to_tref) {\n      if (this.to_tref) {\n        clearTimeout(this.to_tref)\n      }\n      let x = () => {\n        if (this.recv) {\n          this.to_tref = setTimeout(x, this.heartbeat_delay)\n          this.recv.heartbeat()\n        }\n      }\n      this.to_tref = setTimeout(x, this.heartbeat_delay)\n    }\n    return\n  }\n\n  didTimeout () {\n    if (this.to_tref) {\n      clearTimeout(this.to_tref)\n      this.to_tref = null\n    }\n    if (this.readyState !== Transport.CONNECTING && this.readyState !== Transport.OPEN &&\n      this.readyState !== Transport.CLOSING) {\n        throw Error('INVALID_STATE_ERR')\n    }\n    if (this.recv) {\n      throw Error('RECV_STILL_THERE')\n    }\n\n    this.readyState = Transport.CLOSED\n\n    // Node streaming API is broken. Reader defines 'close' and 'end'\n    // but Writer defines only 'close'. 'End' isn't optional though.\n    //  http://nodejs.org/docs/v0.5.8/api/streams.html#event_close_\n    this.connection.emit('end')\n    this.connection.emit('close')\n    this.connection = null\n    if(this.session_id) {\n      delete MAP[this.session_id]\n      this.session_id = null\n    }\n  }\n\n  didMessage (payload) {\n    if (this.readyState === Transport.OPEN) {\n      this.connection.emit('data', payload)\n    }\n  }\n\n  send (payload) {\n    if (this.readyState !== Transport.OPEN) {\n      return false\n    }\n    this.send_buffer.push('' + payload)\n\n    if (this.recv) {\n      this.tryFlush()\n    }\n    return true\n  }\n\n  close (status = 1000, reason = 'Normal Closure') {\n    if (this.readyState !== Transport.OPEN) {\n      return false\n    }\n\n    this.readyState = Transport.CLOSING\n    this.close_frame = closeFrame(status, reason)\n\n    if (this.recv) {\n      this.recv.doSendFrame(this.close_frame)\n      if (this.recv) {\n        this.recv.didClose()\n      }\n      if (this.recv) {\n        this.unregister()\n      }\n    }\n    return true\n  }\n}\n\nSession.bySessionId = function (session_id) {\n  if (!session_id) {\n    return null\n  }\n  return MAP[session_id] || null\n}\n\nconst _register = function (req, server, session_id, receiver) {\n  let session = Session.bySessionId(session_id)\n  if (!session) {\n    session = new Session(session_id, server)\n  }\n  session.register(req, receiver)\n  return session\n}\n\nexport function register (req, server, receiver) {\n  return _register(req, server, req.session, receiver)\n}\n\nexport function registerNoSession (req, server, receiver) {\n  return _register(req, server, undefined, receiver)\n}\n\nexport class GenericReceiver {\n  constructor (thingy) {\n    this.thingy = thingy\n    this.setUp(this.thingy)\n  }\n\n  setUp () {\n    this.thingy_end_cb = () => this.didAbort()\n    this.thingy.addListener('close', this.thingy_end_cb)\n    this.thingy.addListener('end', this.thingy_end_cb)\n  }\n\n  tearDown () {\n    this.thingy.removeListener('close', this.thingy_end_cb)\n    this.thingy.removeListener('end', this.thingy_end_cb)\n    this.thingy_end_cb = null\n  }\n\n  didAbort () {\n    this.delay_disconnect = false\n    this.didClose()\n  }\n\n  didClose () {\n    if (this.thingy) {\n      this.tearDown(this.thingy)\n      this.thingy = null\n    }\n    if (this.session) {\n      this.session.unregister()\n    }\n  }\n\n  doSendBulk (messages) {\n    let q_msgs = messages.map((msg) => utils.quote(msg))\n    this.doSendFrame('a' + '[' + q_msgs.join(',') + ']')\n  }\n\n  heartbeat () {\n    this.doSendFrame('h')\n  }\n}\n\n// Write stuff to response, using chunked encoding if possible.\n\nexport class ResponseReceiver extends GenericReceiver {\n  constructor (request, response, options) {\n    super(request.connection)\n    this.max_response_size = undefined\n    this.delay_disconnect = true\n    this.request = request\n    this.response = response\n    this.options = options\n\n    this.curr_response_size = 0\n    try {\n      this.request.connection.setKeepAlive(true, 5000)\n    }catch (x) { x }\n\n    if (this.max_response_size === undefined) {\n      this.max_response_size = this.options.response_limit\n    } \n  }\n\n  doSendFrame (payload) {\n    this.curr_response_size += payload.length\n    let r = false\n    try {\n      this.response.write(payload)\n      r = true\n    } catch (x) { x }\n    if (this.max_response_size && this.curr_response_size > this.max_response_size) {\n      this.didClose()\n    }\n    return r\n  }\n\n  didClose () {\n    super.didClose()\n    try {\n      this.response.end()\n    } catch (x) {x}\n    this.response = null\n  }\n}\n","import * as FayeWebsocket from 'faye-websocket'\n\nimport * as utils from './utils'\nimport * as transport from './transport'\n\nexport const app = {\n  _websocket_check (req, connection, head) {\n    if (!FayeWebsocket.isWebSocket(req)) {\n      throw {\n        status: 400,\n        message: 'Not a valid websocket request'\n      }\n    }\n  },\n  sockjs_websocket (req, connection, head) {\n    this._websocket_check(req, connection, head)\n    let ws = new FayeWebsocket(req, connection, head, null, this.options.faye_server_options)\n\n    ws.onopen = ()=> transport.registerNoSession(req, this, new WebSocketReceiver(ws, connection))\n    return true\n  },\n  raw_websocket (req, connection, head) {\n    this._websocket_check(req, connection, head)\n    let ver = req.headers['sec-websocket-version'] || ''\n\n    if (['8', '13'].indexOf(ver) === -1) {\n      throw {\n        status: 400,\n        message: 'Only supported WebSocket protocol is RFC 6455.'\n      }\n    }\n    let ws = new FayeWebsocket(req, connection, head, null, this.options.faye_server_options)\n    ws.onopen = () => new RawWebsocketSessionReceiver(req, connection, this, ws)\n\n    return true\n  }\n}\n\nclass WebSocketReceiver extends transport.GenericReceiver {\n  constructor (ws, connection) {\n    super(connection)\n    this.ws = ws\n    this.connection = connection\n    try {\n      this.connection.setKeepAlive(true, 5000)\n      this.connection.setNoDelay(true)\n    } catch (x) {x}\n\n    this.ws.addEventListener('close', this.thingy_end_cb)\n    this.ws.addEventListener('message', (m) => this.didMessage(m.data))\n    this.heartbeat_cb = ()=> this.heartbeat_timeout()\n  }\n\n  tearDown () {\n    this.ws.removeEventListener('close', this.thingy_end_cb)\n    super.tearDown()\n  }\n\n  didMessage (payload) {\n    let message\n    if (this.ws && this.session && payload.length > 0) {\n      try {\n        message = JSON.parse(payload)\n      } catch(x) {\n        return this.didClose(3000, 'Broken framing.')\n      }\n\n      if (payload[0] === '[') {\n        message.forEach((msg) => this.session.didMessage(msg))\n      } else {\n        this.session.didMessage(message)\n      }\n    }\n  }\n\n  doSendFrame (payload) {\n    if (this.ws) {\n      try {\n        this.ws.send(payload)\n        return true\n      } catch(x) { x }\n    }\n    return false\n  }\n\n  didClose (status = 1000, reason = 'Normal closure') {\n    super.didClose()\n    try {\n      this.ws.close(status, reason, false)\n    } catch(x) {x}\n    this.ws = null\n    this.connection = null\n  }\n\n  heartbeat () {\n    let hto_ref\n    let supportsHeartbeats = this.ws.ping(null, () =>{\n            clearTimeout(hto_ref)\n    })\n\n    if(supportsHeartbeats){\n        hto_ref = setTimeout(this.heartbeat_cb, 10000)\n    } else{\n        super.heartbeat()\n    }\n  }\n\n  heartbeat_timeout () {\n    if (this.session) {\n      this.session.close(3000, 'No response from heartbeat')\n    }\n  }\n}\n\nWebSocketReceiver.prototype.protocol = 'websocket'\n\nconst Transport = transport.Transport\n\n// Inheritance only for decorateConnection.\nclass RawWebsocketSessionReceiver {\n    constructor (req, conn, server, ws) {\n        this.ws = ws\n        this.prefix = server.options.prefix\n        this.readyState = Transport.OPEN\n        this.recv = {connection: conn, protocol: \"websocket-raw\"}\n\n        this.connection = new transport.SockJSConnection(this)\n        this.decorateConnection(req)\n        server.emit('connection', this.connection)\n        this._end_cb = ()=> this.didClose()\n        this.ws.addEventListener('close', this._end_cb)\n        this._message_cb = (m) => this.didMessage(m)\n        this.ws.addEventListener('message', this._message_cb)\n    }\n\n    didMessage (m) {\n        if (this.readyState === Transport.OPEN){\n            this.connection.emit('data', m.data)\n        }\n        return\n    }\n\n    send (payload) {\n        if (this.readyState !== Transport.OPEN) {\n            return false\n        }\n        this.ws.send(payload)\n        return true\n    }\n\n    close (status=1000, reason=\"Normal closure\") {\n        if (this.readyState !== Transport.OPEN){\n            return false\n        }\n        this.readyState = Transport.CLOSING\n        this.ws.close(status, reason, false)\n        return true\n    }\n\n    didClose () {\n        if (!this.ws){\n            return\n        }\n        this.ws.removeEventListener('message', this._message_cb)\n        this.ws.removeEventListener('close', this._end_cb)\n        try{\n            this.ws.close(1000, \"Normal closure\", false)\n        } catch(x) {x}\n        this.ws = null\n\n        this.readyState = Transport.CLOSED\n        this.connection.emit('end')\n        this.connection.emit('close')\n        this.connection = null\n    }\n}\n\nutils.objectExtend(RawWebsocketSessionReceiver.prototype, transport.Session.prototype)\n","import * as transport from './transport'\n\nclass JsonpReceiver extends transport.ResponseReceiver {\n  constructor (req, res, options, callback) {\n    super(req, res, options)\n    this.callback = callback\n  }\n\n  doSendFrame (payload) {\n     // Yes, JSONed twice, there isn't a a better way, we must pass\n     // a string back, and the script, will be evaled() by the\n     // browser.\n     // prepend comment to avoid SWF exploit #163\n     super.doSendFrame(\"/**/\" + this.callback + \"(\" + JSON.stringify(payload) + \");\\r\\n\")\n  }\n}\n\nexport const app = {\n  jsonp (req, res, _, next_filter) {\n    if (! ('c' in req.query || 'callback' in req.query)) {\n      throw {\n        status: 500,\n        message: '\"callback\" parameter required'\n      }\n    }\n\n    let callback\n    if ('c' in req.query) {\n      callback = req.query['c']\n    } else {\n      callback = req.query['callback']\n    }\n\n    if(/[^a-zA-Z0-9-_.]/.test(callback) || callback.length > 32) {\n      throw {\n        status: 500,\n        message: 'invalid \"callback\" parameter'\n      }\n    }\n\n        // protect against SWF JSONP exploit \n    res.setHeader('X-Content-Type-Options', 'nosniff')\n    res.setHeader('Content-Type', 'application/javascript; charset=UTF-8')\n    res.writeHead(200)\n\n    transport.register(req, this, new JsonpReceiver(req, res, this.options, callback))\n    return true\n  },\n  jsonp_send (req, res, query) {\n    if(!query){\n      throw {\n        status: 500,\n        message: 'Payload expected.'\n       }\n    }\n    let d\n    if(typeof query === 'string'){\n            try{\n                d = JSON.parse(query)\n            }catch(x){\n                throw {\n                    status: 500,\n                    message: 'Broken JSON encoding.'\n                }\n            }\n    } else {\n      d = query.d\n    }\n    if(typeof d === 'string' && d){\n      try {\n        d = JSON.parse(d)\n      } catch (x) {\n        throw {\n          status: 500,\n          message: 'Broken JSON encoding.'\n        }\n      }\n    }\n    if (!d || d.__proto__.constructor !== Array) {\n      throw {\n        status: 500,\n        message: 'Payload expected'\n      }\n    }\n    let jsonp = transport.Session.bySessionId(req.session)\n    if (jsonp === null) {\n      throw {status: 404}\n    }\n\n    d.forEach((msg) => {\n      jsonp.didMessage(msg)\n    })\n\n    res.setHeader('Content-Length', '2')\n    res.setHeader('Content-Type', 'text/plain; charset=UTF-8')\n    res.writeHead(200)\n    res.end('ok')\n    return true\n\n  }\n}\n","import * as utils from './utils'\nimport * as transport from './transport'\n\nclass XhrStreamingReceiver extends transport.ResponseReceiver {\n  doSendFrame(payload) {\n    return super.doSendFrame(payload + '\\n')\n  }\n}\nXhrStreamingReceiver.prototype.protocol = 'xhr-streaming'\n\nclass XhrPollingReceiver extends XhrStreamingReceiver {}\n\nXhrPollingReceiver.prototype.protocol = 'xhr-polling'\nXhrPollingReceiver.prototype.max_response_size = 1\n\nexport const app = {\n  xhr_options(req, res) {\n    res.statusCode = 204\n    res.setHeader('Access-Control-Allow-Methods', 'OPTIONS, POST')\n    res.setHeader('Access-Control-Max-Age', res.cache_for)\n    return ''\n  },\n  xhr_send(req, res, data) {\n    if (!data) {\n      throw {\n        status: 500,\n        message: 'Payload expected.'\n      }\n    }\n    let d\n    try {\n      d = JSON.parse(data)\n    } catch (x) {\n      throw {\n        status: 500,\n        message: 'Broken JSON encoding.'\n      }\n    }\n\n    if (!d || d.__proto__.constructor !== Array) {\n      throw {\n        status: 500,\n        message: 'Payload expected.'\n      }\n    }\n    let jsonp = transport.Session.bySessionId(req.session)\n    if (!jsonp) {\n      throw {\n        status: 404\n      }\n    }\n    d.forEach((msg) => jsonp.didMessage(msg))\n\n    // FF assumes that the response is XML.\n    res.setHeader('Content-Type', 'text/plain; charset=UTF-8')\n    res.writeHead(204)\n    res.end()\n    return true\n  },\n  xhr_cors(req, res, content) {\n    let origin\n    if (!req.headers['origin']) {\n      origin = '*'\n    } else {\n      origin = req.headers['origin']\n      res.setHeader('Access-Control-Allow-Credentials', 'true')\n    }\n    res.setHeader('Access-Control-Allow-Origin', origin)\n    res.setHeader('Vary', 'Origin')\n    let header = req.headers['access-control-request-headers']\n    if (header) {\n      res.setHeader('Access-Control-Allow-Headers', header)\n    }\n    return content\n  },\n  xhr_poll(req, res, _, next_filter) {\n    res.setHeader('Content-Type', 'application/javascript; charset=UTF-8')\n    res.writeHead(200)\n\n    transport.register(req, this, new XhrPollingReceiver(req, res, this.options))\n    return true\n  },\n  xhr_streaming(req, res, _, next_filter) {\n    res.setHeader('Content-Type', 'application/javascript; charset=UTF-8')\n    res.writeHead(200)\n\n    // IE requires 2KB prefix:\n    //  http://blogs.msdn.com/b/ieinternals/archive/2010/04/06/comet-streaming-in-internet-explorer-with-xmlhttprequest-and-xdomainrequest.aspx\n    res.write(Array(2049).join('h') + '\\n')\n\n    transport.register(req, this, new XhrStreamingReceiver(req, res, this.options))\n    return true\n  }\n\n}\n","import * as utils from './utils'\nconst iframe_template = `\n<!DOCTYPE html>\n<html>\n<head>\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\n  <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n  <script src=\"{{ sockjs_url }}\"></script>\n  <script>\n    document.domain = document.domain;\n    SockJS.bootstrap_iframe();\n  </script>\n</head>\n<body>\n  <h2>Don't panic!</h2>\n  <p>This is a SockJS hidden iframe. It's used for cross domain magic.</p>\n</body>\n</html>\n`\nexport const app = {\n  iframe (req, res) {\n    let context = {\n      '{{ sockjs_url }}' : this.options.sockjs_url\n    }\n\n    let content = iframe_template\n\n    for (let k in context) {\n      content = content.replace(k, context[k])\n    }\n\n    let quoted_md5 = '\"' + utils.md5_hex(content) + '\"'\n    if ('if-none-match' in req.headers && req.headers['if-none-match'] === quoted_md5) {\n      res.statusCode = 304\n      return ''\n    }\n\n    res.setHeader('Content-Type', 'text/html; charset=UTF-8')\n    res.setHeader('ETag', quoted_md5)\n    return content\n  }\n}\n","import * as utils from './utils'\nimport * as transport from './transport'\n\nclass EventSourceReceiver extends transport.ResponseReceiver {\n  doSendFrame (payload) {\n    let data = [\n      'data:',\n       utils.escape_selected(payload, '\\r\\n\\x00'),\n       '\\r\\n\\r\\n'\n    ]\n    super.doSendFrame(data.join(''))\n  }\n}\nEventSourceReceiver.prototype.protocol = 'eventsource'\n\nexport const app = {\n  eventsource (req, res) {\n    let origin\n    if (!req.headers['origin'] || req.headers['origin'] === 'null') {\n      origin = '*'\n    } else {\n      origin = req.headers['origin']\n      res.setHeader('Access-Control-Allow-Credentials', true)\n    }\n    res.setHeader('Content-Type', 'text/event-stream')\n    res.setHeader('Access-Control-Allow-Origin', origin)\n    res.setHeader('Vary', 'Origin')\n    let header = req.headers['access-control-request-headers']\n    if (header) {\n      res.setHeader('Access-Control-Allow-Headers', header)\n    }\n\n    res.writeHead(200)\n    res.write('\\r\\n')\n    transport.register(req, this, new EventSourceReceiver(req, res, this.options))\n    return true\n  }\n}\n","\nimport * as utils from './utils'\nimport * as transport from './transport'\n\nlet iframe_template = `\n<!doctype html>\n<html><head>\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\n  <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n</head><body><h2>Don't panic!</h2>\n  <script>\n    document.domain = document.domain;\n    var c = parent.{{ callback }};\n    c.start();\n    function p(d) {c.message(d);};\n    window.onload = function() {c.stop();};\n  </script>\n  `\niframe_template += Array(1024 - iframe_template.length + 14).join(' ')\niframe_template += '\\r\\n\\r\\n'\n\nclass HtmlFileReceiver extends transport.ResponseReceiver {\n  doSendFrame (payload) {\n    super.doSendFrame( '<script>\\np(' + JSON.stringify(payload) + ');\\n</script>\\r\\n' )\n  }\n}\n\nHtmlFileReceiver.prototype.protocol = 'htmlfile'\n\nexport const app = {\n  htmlfile (req, res) {\n    if (!('c' in req.query || 'callback' in req.query)) {\n      throw {\n        status: 500,\n        message: '\"callback\" parameter required'\n      }\n    }\n\n    let callback\n    if ('c' in req.query) {\n      callback = req.query['c']\n    } else {\n      callback = req.query['callback']\n    }\n\n    if (/[^a-zA-Z0-9-_.]/.test(callback)) {\n      throw {\n        status: 500,\n        message: 'invalid \"callback\" parameter'\n      }\n    }\n\n    res.setHeader('Content-Type', 'text/html; charset=UTF-8')\n    res.writeHead(200)\n    res.write(iframe_template.replace(/{{ callback }}/g, callback));\n\n    transport.register(req, this, new HtmlFileReceiver(req, res, this.options))\n    return true\n  }\n}\n","import * as utils from './utils'\n\nexport const app = {\n  chunking_test (req, res, _, next_filter) {\n    res.setHeader('Content-Type', 'application/javascript; charset=UTF-8')\n    res.writeHead(200)\n    let write = (payload) => {\n      try {\n        res.write(payload + '\\n')\n      } catch (x) {\n        return\n      }\n    }\n\n    utils.timeout_chain([\n      [0, () => write('h')],\n      [1, () => write(Array(2049).join(' ') + 'h')],\n      [5, () => write('h')],\n      [25, () => write('h')],\n      [625, () => write('h')],\n      [3125, () => {write('h'); res.end()}]\n    ])\n    return true;\n  },\n\n  info (req, res, _) {\n    let info = {\n      websocket: this.options.websocket,\n      origins: ['*:*'],\n      cookie_needed: !! this.options.jsessionid,\n      entropy: utils.random32()\n    }\n\n    if (typeof this.options.base_url === 'function') {\n      info.base_url = this.options.base_url()\n    } else if (this.options.base_url) {\n      info.base_url = this.options.base_url\n    }\n\n    res.setHeader('Content-Type', 'application/json; charset=UTF-8')\n    res.writeHead(200)\n    res.end(JSON.stringify(info))\n  },\n\n  info_options (req, res) {\n    res.statusCode = 204\n    res.setHeader('Access-Control-Allow-Methods', 'OPTIONS, GET')\n    res.setHeader('Access-Control-Max-Age', res.cache_for)\n    return ''\n  }\n}\n","import * as events from 'events'\nimport * as fs from 'fs'\n\nimport * as webjs from './webjs'\nimport * as utils from './utils'\n\nimport * as trans_websocket from './trans_websocket'\nimport * as trans_jsonp from './trans_jsonp'\nimport * as trans_xhr from './trans_xhr'\nimport * as iframe from './iframe'\nimport * as trans_eventsource from './trans_eventsource'\nimport * as trans_htmlfile from './trans_htmlfile'\nimport * as chunking_test from './chunking-test'\n\nfunction sockjsVersion() {\n  let pkg\n  try {\n    pkg = fs.readdirSync(__dirname + '/../package.json', 'utf-8')\n  } catch (x) {\n    x\n  }\n  if (pkg) {\n    return JSON.parse(pkg).version\n  } else {\n    return null\n  }\n}\n\nclass App extends webjs.GenericApp {\n  webcome_screen(req, res) {\n    res.setHeader('content-type', 'text/plain; charset=UTF-8')\n    res.writeHead(200)\n    res.end(\"Welcome to SockJS!\\n\")\n    return true\n  }\n\n  handle_404(req, res) {\n    res.setHeader('content-type', 'text/plain; charset=UTF-8')\n    res.writeHead(404)\n    res.end('404 Error: Page not found\\n')\n    return true\n  }\n\n  disabled_transport(req, res, data) {\n    return this.handle_404(req, res, data)\n  }\n\n  h_sid(req, res, data) {\n    // Some load balancers do sticky sessions, but only if there is\n    //  a JSESSIONID cookie. If this cookie isn't yet set, we shall\n    //  set it to a dummy value. It doesn't really matter what, as\n    //  session information is usually added by the load balancer.\n    req.cookies = utils.parseCookie(req.headers.cookie)\n    if (typeof this.options.jsessionid === 'function') {\n      //  Users can supply a function\n      this.options.jsessionid(req, res)\n    } else if (this.options.jsessionid && res.setHeader) {\n      // We need to set it every time, to give the loadbalancer\n      // opportunity to attach its own cookies.\n      let jsid = req.cookies['JSESSIONID'] || 'dummy'\n      res.setHeader('Set-Cookie', 'JSESSIONID=' + jsid + '; path=/')\n    }\n    return data\n  }\n  log(severity, line) {\n    this.options.log(severity, line)\n  }\n}\n\nutils.objectExtend(App.prototype, iframe.app)\nutils.objectExtend(App.prototype, chunking_test.app)\n\nutils.objectExtend(App.prototype, trans_websocket.app)\nutils.objectExtend(App.prototype, trans_jsonp.app)\nutils.objectExtend(App.prototype, trans_xhr.app)\nutils.objectExtend(App.prototype, trans_eventsource.app)\nutils.objectExtend(App.prototype, trans_htmlfile.app)\n\nfunction generate_dispatcher(options) {\n  let p = (s) => new RegExp('^' + options.prefix + s + '[/]?$')\n  let t = (s) => [p('/([^/.]+)/([^/.]+)' + s), 'server', 'session']\n  let opts_filters = (options_filter = 'xhr_options') => {\n    return ['h_sid', 'xhr_cors', 'cache_for', options_filter, 'expose']\n  }\n  let prefix_dispatcher = [\n    ['GET', p(''), ['welcome_screen']],\n    ['GET', p('/iframe[0-9-.a-z_]*.html'), ['iframe', 'cache_for', 'expose']],\n    ['OPTIONS', p('/info'), opts_filters('info_options')],\n    ['GET', p('/info'), ['xhr_cors', 'h_no_cache', 'info', 'expose']],\n    ['OPTIONS', p('/chunking_test'), opts_filters()],\n    ['POST', p('/chunking_test'), ['xhr_cors', 'expect_xhr', 'chunking_test']]\n  ]\n  let transport_dispatcher = [\n    ['GET', t('/jsonp'), ['h_sid', 'h_no_cache', 'jsonp']],\n    ['POST', t('/jsonp_send'), ['h_sid', 'h_no_cache', 'expect_form', 'jsonp_send']],\n    ['POST', t('/xhr'), ['h_sid', 'h_no_cache', 'xhr_cors', 'xhr_poll']],\n    ['OPTIONS', t('/xhr'), opts_filters()],\n    ['POST', t('/xhr_send'), ['h_sid', 'h_no_cache', 'xhr_cors', 'expect_xhr', 'xhr_send']],\n    ['OPTIONS', t('/xhr_send'), opts_filters()],\n    ['POST', t('/xhr_streaming'), ['h_sid', 'h_no_cache', 'xhr_cors', 'xhr_streaming']],\n    ['OPTIONS', t('/xhr_streaming'), opts_filters()],\n    ['GET', t('/eventsource'), ['h_sid', 'h_no_cache', 'eventsource']],\n    ['GET', t('/htmlfile'), ['h_sid', 'h_no_cache', 'htmlfile']],\n  ]\n\n  // TODO: remove this code on next major release\n  if (options.websocket) {\n    prefix_dispatcher.push(\n      ['GET', p('/websocket'), ['raw_websocket']])\n    transport_dispatcher.push(\n      ['GET', t('/websocket'), ['sockjs_websocket']])\n  } else {\n    /// modify urls to return 404\n    prefix_dispatcher.push(\n      ['GET', p('/websocket'), ['cache_for', 'disabled_transport']])\n    transport_dispatcher.push(\n      ['GET', t('/websocket'), ['cache_for', 'disabled_transport']])\n  }\n  return prefix_dispatcher.concat(transport_dispatcher)\n}\n\nclass Listener {\n  constructor(options, emit) {\n    this.options = options\n    this.app = new App()\n    this.app.options = this.options\n    this.app.emit = emit\n    this.app.log('debug', 'SockJS v' + sockjsVersion() + ' ' +\n      'bound to ' + JSON.stringify(this.options.prefix))\n    this.dispatcher = generate_dispatcher(this.options)\n    this.webjs_handler = webjs.generateHandler(this.app, this.dispatcher)\n    this.path_regexp = new RegExp('^' + this.options.prefix + '([/].+|[/]?)$')\n  }\n\n  handler(req, res, extra) {\n    // All urls that match the prefix must be handled by us.\n    if (!req.url.match(this.path_regexp)) {\n      return false\n    }\n    this.webjs_handler(req, res, extra)\n    return true\n  }\n\n  getHandler() {\n    return (a, b, c) => {\n      return this.handler(a, b, c)\n    }\n  }\n}\n\nclass Server extends events.EventEmitter{\n  constructor(user_options) {\n    super()\n    this.options = {\n      prefix: '',\n      response_limit: 128 * 1024,\n      websocket: true,\n      faye_server_options: null,\n      jsessionid: false,\n      heartbeat_delay: 25000,\n      disconnect_delay: 5000,\n      log: (severity, line) => console.log(line),\n      sockjs_url: 'https://cdn.jsdelivr.net/sockjs/1.0.1/sockjs.min.js',\n    }\n    if (user_options) {\n      utils.objectExtend(this.options, user_options)\n    }\n  }\n\n  listener(handler_options) {\n    let options = utils.objectExtend({}, this.options)\n    if (handler_options) {\n      utils.objectExtend(options, handler_options)\n    }\n    return new Listener(options, (event, data) => this.emit.call(this, event, data))\n  }\n\n  installHandlers(http_server, handler_options) {\n    let handler = this.listener(handler_options).getHandler()\n    utils.overshadowListeners(http_server, 'request', handler)\n    utils.overshadowListeners(http_server, 'upgrade', handler)\n    return true\n  }\n  middleware(handler_options) {\n    let handler = this.listener(handler_options).getHandler()\n    handler.upgrade = handler\n    return handler\n  }\n}\n\n// utils.objectExtend(Server.prototype, events.EventEmitter.prototype)\n\nexport function createServer(options) {\n  return new Server(options)\n}\n\nexport function listen(http_server, options) {\n  let srv = createServer(options)\n  if (http_server) {\n    srv.installHandlers(http_server)\n  }\n  return srv\n}\n"],"names":["escape_selected","str","chars","map","len","length","escape","r","RegExp","parts","split","i","v","join","buffer_concat","buf_a","buf_b","dst","Buffer","copy","md5_hex","data","crypto","update","digest","timeout_chain","arr","slice","shift","timeout","user_fun","fun","objectExtend","src","k","hasOwnProperty","overshadowListeners","ee","event","handler","old_listeners","listeners","removeAllListeners","new_handler","apply","arguments","forEach","listener","addListener","ESCAPABLE","unroll_lookup","escapable","unrolled","c","push","String","fromCharCode","lastIndex","replace","a","charCodeAt","toString","lookup","quote","string","quoted","JSON","stringify","test","parseCookie","cookie_header","cookies","cookie","trim","random32","randArr","execute_request","app","funs","req","res","last_fun","next_filter","x","status","fake_response","headers","writeHead","user_headers","httpVersion","http","keys","concat","write","_","end","setHeader","generateHandler","dispatcher","head","url","start_date","Date","found","allowed_methods","row","_i","method","path","constructor","Array","m","pathname","match","pt","_len","GenericApp","finished","methods","Allow","message","log","href","stack","td","statusCode","severity","line","content","getHeader","expose","filename","o","error","cahce_for","cache_for","exp","setTime","getTime","toUTCString","_data","next_fitler","q","on","d","utils","querystring","undefined","Transport","CONNECTING","OPEN","CLOSING","CLOSED","closeFrame","reason","SockJSConnection","_session","id","uuid","prefix","send","close","code","destroy","stream","prototype","__defineGetter__","readyState","MAP","Session","session_id","server","heartbeat_delay","options","disconnect_delay","send_buffer","is_closing","timeout_cb","didTimeout","to_tref","setTimeout","connection","emit_open","emit","recv","doSendFrame","didClose","flushToRecv","close_frame","session","decorateConnection","nextTick","tryFlush","socket","remoteAddress","remotePort","address","response","protocol","delay","delay_disconnec","sb","doSendBulk","heartbeat","Error","payload","unregister","bySessionId","_register","receiver","register","registerNoSession","GenericReceiver","thingy","setUp","thingy_end_cb","didAbort","removeListener","delay_disconnect","tearDown","messages","q_msgs","msg","ResponseReceiver","request","max_response_size","curr_response_size","setKeepAlive","response_limit","FayeWebsocket","_websocket_check","ws","faye_server_options","onopen","transport","WebSocketReceiver","ver","indexOf","RawWebsocketSessionReceiver","setNoDelay","addEventListener","didMessage","heartbeat_cb","heartbeat_timeout","removeEventListener","parse","hto_ref","supportsHeartbeats","ping","conn","_end_cb","_message_cb","JsonpReceiver","callback","query","__proto__","jsonp","XhrStreamingReceiver","XhrPollingReceiver","origin","header","iframe_template","context","sockjs_url","quoted_md5","EventSourceReceiver","HtmlFileReceiver","info","websocket","jsessionid","base_url","sockjsVersion","pkg","fs","__dirname","version","App","handle_404","jsid","webjs","iframe","chunking_test","trans_websocket","trans_jsonp","trans_xhr","trans_eventsource","trans_htmlfile","generate_dispatcher","p","s","t","opts_filters","options_filter","prefix_dispatcher","transport_dispatcher","Listener","webjs_handler","path_regexp","extra","b","Server","user_options","console","handler_options","call","http_server","getHandler","upgrade","events","createServer","listen","srv","installHandlers"],"mappings":"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"}